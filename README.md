# セガサターンで動作するブートローダー

独自形式の実行可能プログラムをメモリへロードし実行します。現状ではMIDI経由でのロードにのみ対応しています。

## ビルド環境

ブートローダー部分はすべて`Bash`のシェルスクリプトで書かれています。そして、ビルドの流れの制御に`Make`を使用しています。そのため、基本的には`Bash`と`Make`が使えれば基本的にはOKです。

実行時にセガサターンとMIDIで接続したPC側から実行可能プログラムを送るツールはC言語で書かれています。そのビルドに`gcc`を使用します。（特に`gcc`に依存した書き方はしていないつもりなので、[Makefile](tools/Makefile)を書き換えれば他のコンパイラでもビルドできるかと思います。）

## ビルド方法

ブートローダーのビルドの際は、このリポジトリを`git clone`したディレクトリ直下で`make`コマンドを実行してください。

```bash
$ make
```

実行が完了すると、ディスクイメージとして`sh_ss_bootloader.iso`・`sh_ss_bootloader.cue`の2つのファイルが作成されています。

```bash
$ ls *.{iso,cue}
sh_ss_bootloader.cue  sh_ss_bootloader.iso
```

## 実行可能プログラム

ブートローダーでロードと実行が可能なプログラムについて詳しくは[`apps`ディレクトリのREADME](apps/README.md)を参照してください。

## 実行方法

PC側はLinux環境を想定しています。

1. PCにMIDIをUSBへ変換するケーブル(以降、USB-MIDIと記述)を接続
2. `dmesg`等でUSB-MIDIを認識したデバイスファイル名を確認
3. 確認したデバイスファイル名で[`exec.sh`](exec.sh)の`MIDI_DEV`変数の内容を書き換え
   - `exec.sh`は、指定された名前の`apps`内のプログラムをビルド、MIDIメッセージ化し、MIDI経由でブートローダーへ送信するスクリプト
4. セガサターンとPCをMIDIで接続
   - セガサターン側には拡張通信端子からMIDIを接続できるようにする変換ケーブルを使用する
5. [Satiator](https://www.satiator.net/)等を使用し、作成したブートローダーのディスクイメージをセガサターン実機で起動
6. PC側で以下のようにコマンドを実行すると、指定した実行可能プログラムをセガサターン側へロード・実行させることができる
   - 例）[`hello`](apps/hello.sh)の場合
     ```bash
     $ ./exec.sh hello
     ```
